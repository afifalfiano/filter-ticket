"use strict";(self.webpackChunkfilter_ticket=self.webpackChunkfilter_ticket||[]).push([[849,487],{60487:function(e,a,n){n.r(a);var t=n(42982),l=n(74165),s=n(1413),i=n(15861),r=n(70885),o=n(72791),c=n(95048),u=n(16871),d=n(55705),v=n(64671),m=n(97650),h=n(26290),p=n(26968),x=n(86017),b=n(87416),f=n(11803),g=n(19585),k=n(14450),j=n(80184);a.default=function(e){var a=e.rfoSingle,n=e.idComplain,_=(0,u.TH)(),Z=(0,o.useState)(null),N=(0,r.Z)(Z,2),w=N[0],S=N[1],y=(0,o.useState)(!1),D=(0,r.Z)(y,2),F=D[0],C=D[1],M=(0,o.useState)([]),B=(0,r.Z)(M,2),z=B[0],K=B[1],L=(0,u.UO)().id,A=(0,u.s0)(),I=(0,v.rS)(),T=(0,r.Z)(I,1)[0],H=(0,v.qA)(),O=(0,r.Z)(H,1)[0],V=(0,c.I0)(),R=(0,v.s)(),U=(0,r.Z)(R,1)[0],W=(0,b.Wb)(),E=(0,r.Z)(W,1)[0],J=(0,o.useState)(0),X=(0,r.Z)(J,2),Y=X[0],q=X[1],G=(0,c.v9)(h.Ms),P=function(e){K(e)},Q=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(){var a,t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=void 0!==n?n:L,e.next=4,T(a).unwrap();case 4:t=e.sent,V((0,m.LA)((0,s.Z)({},t))),S(t.data),0===Y&&window.location.href.includes("/dashboard/detail/")&&se(t.data),q(Y++),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),(0,f.Z)(e.t0,!0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),$=(0,c.v9)(p.HF).data,ee=_.pathname.includes("history"),ae=(0,b.b0)(),ne=(0,r.Z)(ae,1)[0],te=(0,b.BB)(),le=(0,r.Z)(te,1)[0],se=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(a){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={keluhan_id:a.id_keluhan},e.prev=1,e.next=4,le({body:n}).unwrap();case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),(0,f.Z)(e.t0,!1),new Error("Unsuccess read all notification");case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(a){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){if(Q(),void 0===n){var e=[].concat((0,t.Z)(G.data),[{path:"/dashboard/detail/".concat(L),title:"Detail Dasbor"}]);V((0,h.oi)(e)),setTimeout((function(){window.scrollTo(0,document.body.scrollHeight)}),500);var a=setInterval((function(){Q()}),3e4);return function(){clearInterval(a)}}}),[]);var ie=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(a){var n,t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={keluhan_id:a,pop_id:$.pop_id,id_response:1},e.next=4,ne({body:n}).unwrap();case 4:return t=e.sent,e.abrupt("return",t);case 8:e.prev=8,e.t0=e.catch(0),(0,f.Z)(e.t0,!0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(a){return e.apply(this,arguments)}}(),re=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(a){var n,t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={notifikasi_id:a},e.next=4,E({body:n}).unwrap();case 4:return t=e.sent,e.abrupt("return",t);case 8:e.prev=8,e.t0=e.catch(0),(0,f.Z)(e.t0,!0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(a){return e.apply(this,arguments)}}(),oe=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(a,n){var t,i,r,o,c,u,d,v;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={balasan:a.balasan,user_id:$.id_user,keluhan_id:w.id_keluhan},e.next=4,O((0,s.Z)({},t));case 4:if("success"!==(i=e.sent).data.status&&"Success"!==i.data.status){e.next=29;break}if(n(),C(!0),(0,g.Z)(i),!(z.length>0)){e.next=15;break}for((o=new FormData).append("balasan_id",null===i||void 0===i||null===(r=i.data)||void 0===r?void 0:r.id_balasan),c=0;c<z.length;c++)o.append("path[".concat(c,"]"),z[c]);return e.next=15,U({body:o}).unwrap();case 15:return e.next=17,ie(w.id_keluhan);case 17:if("Success"!==(null===(u=e.sent)||void 0===u?void 0:u.status)&&"success"!==(null===u||void 0===u?void 0:u.status)){e.next=25;break}return e.next=21,re(null===u||void 0===u||null===(d=u.notifikasi)||void 0===d?void 0:d.id_notifikasi);case 21:"Success"===(null===(v=e.sent)||void 0===v?void 0:v.status)||"success"===(null===v||void 0===v?void 0:v.status)?(Q(),C(!1)):((0,f.Z)(v,!0),C(!1)),e.next=27;break;case 25:C(!1),(0,f.Z)(u,!0);case 27:e.next=30;break;case 29:(0,f.Z)(i,!0);case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(0),(0,f.Z)(e.t0,!0);case 35:case"end":return e.stop()}}),e,null,[[0,32]])})));return function(a,n){return e.apply(this,arguments)}}();return(0,j.jsxs)("div",{children:[!a&&(0,j.jsx)(k.tW,{detailComplain:w}),(0,j.jsxs)("div",{className:"flex w-full flex-col py-5",children:[(0,j.jsx)(k.wS,{detailComplain:w}),(0,j.jsx)("hr",{}),(null===w||void 0===w?void 0:w.balasan.length)>0&&(null===w||void 0===w?void 0:w.balasan.map((function(e,a){return(0,j.jsx)(k.Ex,{item:e},a)}))),ee||a||"open"!==(null===w||void 0===w?void 0:w.status)?!a&&(0,j.jsx)("div",{className:"text-center items-center justify-center mt-10",children:(0,j.jsx)(k.zx,{className:"mr-5",onClick:function(){return A(ee?"/history_dashboard":"/dashboard")},children:"Kembali"})}):(0,j.jsx)(d.J9,{enableReinitialize:!0,validationSchema:x.zd,initialValues:{balasan:""},onSubmit:function(e,a){var n=a.resetForm;oe(e,n)},children:function(e){var a=e.values,n=e.errors,t=e.touched,l=e.isValid,s=e.setFieldValue;return(0,j.jsxs)(d.l0,{id:"answer",children:[(0,j.jsxs)("div",{className:"form-control",children:[(0,j.jsx)("label",{htmlFor:"balasan",className:"label",children:(0,j.jsx)("span",{className:"label-text",children:" Balasan"})}),(0,j.jsx)(k.H4,{setFieldValue:function(e){return s("balasan",e)},value:a.balasan,resetData:F}),n.balasan&&t.balasan?(0,j.jsx)("div",{className:"label label-text text-red-500",children:n.balasan}):null]}),(0,j.jsx)(k.G1,{getFile:P}),(0,j.jsxs)("div",{className:"text-center items-center justify-center mt-10",children:[(0,j.jsx)(k.zx,{className:"mr-5",onClick:function(){return A("/dashboard")},children:"Kembali"}),(0,j.jsx)(k.zx,{type:"submit",disabled:!l,className:"btn-success",children:"Simpan"})]})]})}})]})]})}},43849:function(e,a,n){n.r(a);var t=n(42982),l=n(1413),s=n(74165),i=n(15861),r=n(70885),o=n(72791),c=n(95048),u=n(16871),d=n(43504),v=n(64671),m=n(58812),h=n(97650),p=n(74102),x=n(60487),b=n(55705),f=n(26290),g=n(26968),k=n(86017),j=n(11803),_=n(19585),Z=n(14450),N=n(80184);a.default=function(){var e=(0,u.s0)(),a=(0,u.TH)(),n=(0,c.I0)(),w=(0,u.UO)().id,S=a.pathname.includes("history"),y=(0,d.lr)(),D=(0,r.Z)(y,1)[0].get("id_rfo"),F=(0,c.v9)(f.Ms),C=(0,o.useState)(null),M=(0,r.Z)(C,2),B=M[0],z=M[1],K=(0,o.useState)(null),L=(0,r.Z)(K,2),A=L[0],I=L[1],T=(0,v.rS)(),H=(0,r.Z)(T,1)[0],O=(0,m.NJ)(),V=(0,r.Z)(O,1)[0],R=(0,m.AA)(),U=(0,r.Z)(R,1)[0],W=(0,m.mX)(),E=(0,r.Z)(W,1)[0],J=(0,v.OA)(),X=(0,r.Z)(J,1)[0],Y=(0,m.Xf)(),q=(0,r.Z)(Y,1)[0],G=(0,c.v9)(g.HF).data,P={problem:(null===A||void 0===A?void 0:A.problem)||"",action:(null===A||void 0===A?void 0:A.action)||"",deskripsi:(null===A||void 0===A?void 0:A.deskripsi)||"",mulai_gangguan:new Date(null===A||void 0===A?void 0:A.mulai_gangguan).toLocaleString()||"",selesai_gangguan:new Date(null===A||void 0===A?void 0:A.selesai_gangguan).toLocaleString()||"",nomor_tiket:(null===A||void 0===A?void 0:A.nomor_tiket)||"",durasi:(null===A||void 0===A?void 0:A.durasi)||"",lampiran:(null===A||void 0===A?void 0:A.lammpiran)||""},Q=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V(D).unwrap();case 3:"success"===(a=e.sent).status||"Success"===a.status?(n((0,p.UT)(a.data)),I(a.data),P={problem:null===A||void 0===A?void 0:A.problem,action:null===A||void 0===A?void 0:A.action,deskripsi:null===A||void 0===A?void 0:A.deskripsi,mulai_gangguan:new Date(null===A||void 0===A?void 0:A.mulai_gangguan).toLocaleString(),selesai_gangguan:new Date(null===A||void 0===A?void 0:A.selesai_gangguan).toLocaleString(),nomor_tiket:null===A||void 0===A?void 0:A.nomor_tiket,durasi:null===A||void 0===A?void 0:A.durasi,lampiran:null===A||void 0===A?void 0:A.lammpiran}):(0,j.Z)(a,!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),(0,j.Z)(e.t0,!0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H(w).unwrap();case 3:a=e.sent,n((0,h.LA)((0,l.Z)({},a))),z(a.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),(0,j.Z)(e.t0,!0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){var e=[].concat((0,t.Z)(F.data),[{path:"/dashboard/rfo_single/".concat(w,"?id_rfo=").concat(D),title:"Dasbor Reason For Outage Keluhan"}]);n((0,f.oi)(e)),$(),"null"!==D&&Q()}),[]);var ee=function(){var a=(0,i.Z)((0,s.Z)().mark((function a(n,t){var l,i,r,o,c,u,d,v,m,h,p,x,b,f;return(0,s.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(l=new Date(B.created_at),i=(null===B||void 0===B?void 0:B.balasan.length)>0?null===B||void 0===B?void 0:B.balasan[B.balasan.length-1].created_at:null===B||void 0===B?void 0:B.created_at,r=new Date(i),o="".concat(l.getFullYear(),"-").concat(1===l.getMonth().toString().length?"0".concat(l.getMonth()+1):l.getMonth()+1,"-").concat(1===l.getDate().toString().length?"0".concat(l.getDate()):l.getDate()," 12:00:00.000"),c="".concat(r.getFullYear(),"-").concat(1===r.getMonth().toString().length?"0".concat(r.getMonth()+1):r.getMonth()+1,"-").concat(1===r.getDate().toString().length?"0".concat(r.getDate()):r.getDate()," 12:00:00.000"),u={nomor_tiket:n.nomor_tiket,mulai_keluhan:o,selesai_keluhan:c,problem:n.problem,action:n.action,status:"closed",deskripsi:n.deskripsi,user_id:G.id_user,keluhan_id:B.id_keluhan},a.prev=6,"null"!==D){a.next=13;break}return a.next=10,U(u).unwrap();case 10:m=a.sent,a.next=16;break;case 13:return a.next=15,E({id:D,body:u}).unwrap();case 15:m=a.sent;case 16:if("success"!==(null===(d=m)||void 0===d?void 0:d.status)&&"Success"!==(null===(v=m)||void 0===v?void 0:v.status)){a.next=30;break}return(0,_.Z)(m),h={rfo_keluhan_id:m.id_rfo_keluhan},a.next=21,q({id:w,body:h});case 21:if("success"!==(p=a.sent).data.status&&"Success"!==p.data.status){a.next=28;break}return(0,_.Z)(p),a.next=26,X(B.id_keluhan);case 26:"success"===(null===(f=a.sent)||void 0===f||null===(x=f.data)||void 0===x?void 0:x.status)||"Success"===(null===f||void 0===f||null===(b=f.data)||void 0===b?void 0:b.status)?((0,_.Z)(f),setTimeout((function(){t(),e("/dashboard",{replace:!0})}),1e3)):(0,j.Z)(f,!0);case 28:a.next=31;break;case 30:(0,j.Z)(m,!0);case 31:a.next=36;break;case 33:a.prev=33,a.t0=a.catch(6),(0,j.Z)(a.t0,!0);case 36:case"end":return a.stop()}}),a,null,[[6,33]])})));return function(e,n){return a.apply(this,arguments)}}();return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(Z.tW,{detailComplain:B}),(0,N.jsxs)("div",{className:"flex w-full gap-5 mt-5 flex-col-reverse lg:flex-row",children:[(0,N.jsxs)("div",{className:"flex-1 w-full mt-5",children:[(0,N.jsx)("h1",{className:"text-center font-semibold",children:"Reason For Outage Keluhan"}),(0,N.jsx)(b.J9,{enableReinitialize:!0,validationSchema:k.sw,initialValues:P,onSubmit:function(e,a){var n=a.resetForm;ee(e,n)},children:function(a){var n=a.values,t=a.errors,l=a.touched,s=a.isValid,i=a.handleChange,r=a.handleBlur;return(0,N.jsxs)(b.l0,{children:[(0,N.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,N.jsxs)("div",{className:"form-control",children:[(0,N.jsx)("label",{htmlFor:"problem",className:"label",children:(0,N.jsx)("span",{className:"label-text",children:" Masalah:"})}),(0,N.jsx)(b.gN,{id:"problem",name:"problem",placeholder:"Masalah",value:n.problem,disabled:!(!S&&"closed"!==(null===B||void 0===B?void 0:B.status))||null,component:"textarea",onBlur:r,onChange:i,className:"textarea textarea-bordered h-24"}),t.problem&&l.problem?(0,N.jsx)("div",{className:"label label-text text-red-500",children:t.problem}):null]}),(0,N.jsxs)("div",{className:"form-control",children:[(0,N.jsx)("label",{htmlFor:"action",className:"label",children:(0,N.jsx)("span",{className:"label-text",children:" Aksi:"})}),(0,N.jsx)(b.gN,{id:"action",name:"action",placeholder:"Aksi",value:n.action,component:"textarea",onBlur:r,onChange:i,disabled:!(!S&&"closed"!==(null===B||void 0===B?void 0:B.status))||null,className:"textarea textarea-bordered h-24"}),t.action&&l.action?(0,N.jsx)("div",{className:"label label-text text-red-500",children:t.action}):null]}),(0,N.jsxs)("div",{className:"form-control",children:[(0,N.jsx)("label",{htmlFor:"deskripsi",className:"label",children:(0,N.jsx)("span",{className:"label-text",children:" Deskripsi:"})}),(0,N.jsx)(b.gN,{id:"deskripsi",name:"deskripsi",placeholder:"Deskripsi",value:n.deskripsi,component:"textarea",onBlur:r,onChange:i,disabled:!(!S&&"closed"!==(null===B||void 0===B?void 0:B.status))||null,className:"textarea textarea-bordered h-24"}),t.deskripsi&&l.deskripsi?(0,N.jsx)("div",{className:"label label-text text-red-500",children:t.deskripsi}):null]}),(0,N.jsxs)("div",{className:"flex flex-col lg:flex-row gap-5",children:[(0,N.jsxs)("div",{className:"form-control flex-1",children:[(0,N.jsx)("label",{htmlFor:"mulai_gangguan",className:"label",children:(0,N.jsx)("span",{className:"label-text",children:" Waktu Mulai Keluhan"})}),(0,N.jsx)(b.gN,{id:"mulai_gangguan",name:"mulai_gangguan",placeholder:"",value:new Date(null===B||void 0===B?void 0:B.created_at).toLocaleString("id-ID"),type:"text",onBlur:r,onChange:i,disabled:!0,className:"input input-md input-bordered  max-w-full"}),t.mulai_gangguan&&l.mulai_gangguan?(0,N.jsx)("div",{className:"label label-text text-red-500",children:t.mulai_gangguan}):null]}),(0,N.jsxs)("div",{className:"form-control flex-1",children:[(0,N.jsx)("label",{htmlFor:"selesai_gangguan",className:"label",children:(0,N.jsx)("span",{className:"label-text",children:" Waktu Selesai Keluhan"})}),(0,N.jsx)(b.gN,{id:"selesai_gangguan",name:"selesai_gangguan",placeholder:"",value:(null===B||void 0===B?void 0:B.balasan.length)>0?new Date(null===B||void 0===B?void 0:B.balasan[B.balasan.length-1].created_at).toLocaleString("id-ID"):new Date(null===B||void 0===B?void 0:B.created_at).toLocaleString("id-ID"),type:"text",onBlur:r,onChange:i,disabled:!0,className:"input input-md input-bordered  max-w-full"}),t.selesai_gangguan&&l.selesai_gangguan?(0,N.jsx)("div",{className:"label label-text text-red-500",children:t.selesai_gangguan}):null]})]})]}),(0,N.jsx)("div",{className:"flex gap-3 mt-2",children:(0,N.jsxs)("div",{className:"form-control flex-1",children:[(0,N.jsx)("label",{htmlFor:"nomor_tiket",className:"label",children:(0,N.jsx)("span",{className:"label-text",children:" Tiket Pelaporan (Opsional)"})}),(0,N.jsx)(b.gN,{id:"nomor_tiket",name:"nomor_tiket",placeholder:"",value:n.nomor_tiket,type:"text",onBlur:r,onChange:i,disabled:!(!S&&"closed"!==(null===B||void 0===B?void 0:B.status))||null,className:"input input-md input-bordered  max-w-full"})]})}),!S&&"open"===(null===B||void 0===B?void 0:B.status)||"null"===D?(0,N.jsxs)("div",{className:"modal-action justify-center mt-10",children:[(0,N.jsx)(Z.zx,{type:"button",onClick:function(){return e("/dashboard")},children:"Kembali"}),(0,N.jsx)(Z.zx,{disabled:!s,type:"submit",className:"btn-success",children:"Simpan"})]}):(0,N.jsx)("div",{className:"modal-action justify-center mt-10",children:(0,N.jsx)(Z.zx,{type:"button",className:"mr-5",onClick:function(){return S&&"closed"===(null===B||void 0===B?void 0:B.status)?e("/history_dashboard"):e("/dashboard")},children:"Kembali"})})]})}})]}),(0,N.jsx)("div",{className:" border-gray-100 border-2"}),(0,N.jsxs)("div",{className:"flex-1 overflow-auto mt-6 w-full",style:{height:"50rem"},children:[(0,N.jsx)("h1",{className:"text-center font-semibold",children:"Riwayat Follow Up Keluhan"}),(0,N.jsx)(x.default,{rfoSingle:!0})]})]})]})}}}]);
//# sourceMappingURL=849.21ace573.chunk.js.map