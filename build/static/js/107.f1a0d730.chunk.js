"use strict";(self.webpackChunkfilter_ticket=self.webpackChunkfilter_ticket||[]).push([[107,487],{60487:function(e,a,n){n.r(a);var t=n(42982),l=n(74165),s=n(1413),i=n(15861),r=n(70885),o=n(72791),c=n(95048),u=n(16871),d=n(55705),v=n(64671),h=n(97650),m=n(26290),p=n(26968),x=n(86017),f=n(87416),g=n(11803),b=n(19585),k=n(14450),j=n(80184);a.default=function(e){var a=e.rfoSingle,n=e.idComplain,_=(0,u.TH)(),N=(0,o.useState)(null),Z=(0,r.Z)(N,2),w=Z[0],S=Z[1],y=(0,o.useState)(!1),D=(0,r.Z)(y,2),F=D[0],C=D[1],M=(0,o.useState)([]),B=(0,r.Z)(M,2),H=B[0],z=B[1],T=(0,u.UO)().id,I=(0,u.s0)(),K=(0,v.rS)(),U=(0,r.Z)(K,1)[0],V=(0,v.qA)(),O=(0,r.Z)(V,1)[0],R=(0,c.I0)(),W=(0,v.s)(),A=(0,r.Z)(W,1)[0],E=(0,f.Wb)(),L=(0,r.Z)(E,1)[0],J=(0,o.useState)(0),Y=(0,r.Z)(J,2),q=Y[0],G=Y[1],P=(0,c.v9)(m.Ms),X=function(e){z(e)},Q=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(){var a,t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=void 0!==n?n:T,e.next=4,U(a).unwrap();case 4:t=e.sent,R((0,h.LA)((0,s.Z)({},t))),S(t.data),0===q&&window.location.href.includes("/dashboard/detail/")&&se(t.data),G(q++),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),(0,g.Z)(e.t0,!0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),$=(0,c.v9)(p.HF).data,ee=_.pathname.includes("history"),ae=(0,f.b0)(),ne=(0,r.Z)(ae,1)[0],te=(0,f.BB)(),le=(0,r.Z)(te,1)[0],se=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(a){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={keluhan_id:a.id_keluhan},e.prev=1,e.next=4,le({body:n}).unwrap();case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),(0,g.Z)(e.t0,!1),new Error("Unsuccess read all notification");case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(a){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){if(Q(),void 0===n){var e=[].concat((0,t.Z)(P.data),[{path:"/dashboard/detail/".concat(T),title:"Detail Dasbor"}]);R((0,m.oi)(e)),setTimeout((function(){window.scrollTo(0,document.body.scrollHeight)}),500);var a=setInterval((function(){Q()}),3e4);return function(){clearInterval(a)}}}),[]);var ie=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(a){var n,t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={keluhan_id:a,pop_id:$.pop_id,id_response:1},e.next=4,ne({body:n}).unwrap();case 4:return t=e.sent,e.abrupt("return",t);case 8:e.prev=8,e.t0=e.catch(0),(0,g.Z)(e.t0,!0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(a){return e.apply(this,arguments)}}(),re=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(a){var n,t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={notifikasi_id:a},e.next=4,L({body:n}).unwrap();case 4:return t=e.sent,e.abrupt("return",t);case 8:e.prev=8,e.t0=e.catch(0),(0,g.Z)(e.t0,!0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(a){return e.apply(this,arguments)}}(),oe=function(){var e=(0,i.Z)((0,l.Z)().mark((function e(a,n){var t,i,r,o,c,u,d,v;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={balasan:a.balasan,user_id:$.id_user,keluhan_id:w.id_keluhan},e.next=4,O((0,s.Z)({},t));case 4:if("success"!==(i=e.sent).data.status&&"Success"!==i.data.status){e.next=29;break}if(n(),C(!0),(0,b.Z)(i),!(H.length>0)){e.next=15;break}for((o=new FormData).append("balasan_id",null===i||void 0===i||null===(r=i.data)||void 0===r?void 0:r.id_balasan),c=0;c<H.length;c++)o.append("path[".concat(c,"]"),H[c]);return e.next=15,A({body:o}).unwrap();case 15:return e.next=17,ie(w.id_keluhan);case 17:if("Success"!==(null===(u=e.sent)||void 0===u?void 0:u.status)&&"success"!==(null===u||void 0===u?void 0:u.status)){e.next=25;break}return e.next=21,re(null===u||void 0===u||null===(d=u.notifikasi)||void 0===d?void 0:d.id_notifikasi);case 21:"Success"===(null===(v=e.sent)||void 0===v?void 0:v.status)||"success"===(null===v||void 0===v?void 0:v.status)?(Q(),C(!1)):((0,g.Z)(v,!0),C(!1)),e.next=27;break;case 25:C(!1),(0,g.Z)(u,!0);case 27:e.next=30;break;case 29:(0,g.Z)(i,!0);case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(0),(0,g.Z)(e.t0,!0);case 35:case"end":return e.stop()}}),e,null,[[0,32]])})));return function(a,n){return e.apply(this,arguments)}}();return(0,j.jsxs)("div",{children:[!a&&(0,j.jsx)(k.tW,{detailComplain:w}),(0,j.jsxs)("div",{className:"flex w-full flex-col py-5",children:[(0,j.jsx)(k.wS,{detailComplain:w}),(0,j.jsx)("hr",{}),(null===w||void 0===w?void 0:w.balasan.length)>0&&(null===w||void 0===w?void 0:w.balasan.map((function(e,a){return(0,j.jsx)(k.Ex,{item:e},a)}))),ee||a||"open"!==(null===w||void 0===w?void 0:w.status)?!a&&(0,j.jsx)("div",{className:"text-center items-center justify-center mt-10",children:(0,j.jsx)(k.zx,{className:"mr-5",onClick:function(){return I(ee?"/history_dashboard":"/dashboard")},children:"Kembali"})}):(0,j.jsx)(d.J9,{enableReinitialize:!0,validationSchema:x.zd,initialValues:{balasan:""},onSubmit:function(e,a){var n=a.resetForm;oe(e,n)},children:function(e){var a=e.values,n=e.errors,t=e.touched,l=e.isValid,s=e.setFieldValue;return(0,j.jsxs)(d.l0,{id:"answer",children:[(0,j.jsxs)("div",{className:"form-control",children:[(0,j.jsx)("label",{htmlFor:"balasan",className:"label",children:(0,j.jsx)("span",{className:"label-text",children:" Balasan"})}),(0,j.jsx)(k.H4,{setFieldValue:function(e){return s("balasan",e)},value:a.balasan,resetData:F}),n.balasan&&t.balasan?(0,j.jsx)("div",{className:"label label-text text-red-500",children:n.balasan}):null]}),(0,j.jsx)(k.G1,{getFile:X}),(0,j.jsxs)("div",{className:"text-center items-center justify-center mt-10",children:[(0,j.jsx)(k.zx,{className:"mr-5",onClick:function(){return I("/dashboard")},children:"Kembali"}),(0,j.jsx)(k.zx,{type:"submit",disabled:!l,className:"btn-success",children:"Simpan"})]})]})}})]})]})}},43107:function(e,a,n){n.r(a);var t=n(42982),l=n(74165),s=n(15861),i=n(70885),r=n(72791),o=n(95048),c=n(16871),u=n(43504),d=n(55705),v=n(58812),h=n(74102),m=n(60487),p=n(26968),x=n(26290),f=n(86017),g=n(11803),b=n(19585),k=n(14450),j=n(80184);a.default=function(){var e,a=(0,c.UO)().id,n=(0,u.lr)(),_=(0,i.Z)(n,1)[0].get("edit"),N=(0,v.NJ)(),Z=(0,i.Z)(N,2),w=Z[0],S=Z[1].isSuccess,y=(0,r.useState)(null),D=(0,i.Z)(y,2),F=D[0],C=D[1],M=(0,o.I0)(),B=function(){var e=(0,s.Z)((0,l.Z)().mark((function e(){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w(a).unwrap();case 3:"success"===(n=e.sent).status||"Success"===n.status?(M((0,h.UT)(n)),C(n.data)):(0,g.Z)(n,!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),(0,g.Z)(e.t0,!0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),H=(0,o.v9)(x.Ms);(0,r.useEffect)((function(){var e=[].concat((0,t.Z)(H.data),[{path:"/reason_of_outage/detail_single/".concat(a),title:"Detail Reason For Outage"}]);M((0,x.oi)(e)),B()}),[]);var z={problem:(null===F||void 0===F?void 0:F.problem)||"",action:(null===F||void 0===F?void 0:F.action)||"",deskripsi:(null===F||void 0===F?void 0:F.action)||"",mulai_gangguan:(null===F||void 0===F?void 0:F.mulai_gangguan)||"",selesai_gangguan:(null===F||void 0===F?void 0:F.selesai_gangguan)||"",nomor_tiket:(null===F||void 0===F?void 0:F.nomor_tiket)||"",durasi:(null===F||void 0===F?void 0:F.durasi)||"",lampiran:(null===F||void 0===F?void 0:F.lampiran)||""},T=(0,v.mX)(),I=(0,i.Z)(T,1)[0],K=(0,o.v9)(p.HF).data,U=function(){var e=(0,s.Z)((0,l.Z)().mark((function e(n){var t,s,i,r,o,c,u,d,v,m,p,x,f;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new Date(null===F||void 0===F?void 0:F.keluhan.created_at),d=(null===F||void 0===F||null===(t=F.keluhan)||void 0===t||null===(s=t.balasan)||void 0===s?void 0:s.length)>0?null===F||void 0===F||null===(i=F.keluhan)||void 0===i?void 0:i.balasan[(null===F||void 0===F||null===(r=F.keluhan)||void 0===r||null===(o=r.balasan)||void 0===o?void 0:o.length)-1].created_at:null===F||void 0===F||null===(c=F.keluhan)||void 0===c?void 0:c.created_at,v=new Date(d),m="".concat(u.getFullYear(),"-").concat(1===u.getMonth().toString().length?"0".concat(u.getMonth()+1):u.getMonth()+1,"-").concat(1===u.getDate().toString().length?"0".concat(u.getDate()):u.getDate()," 12:00:00.000"),p="".concat(v.getFullYear(),"-").concat(1===v.getMonth().toString().length?"0".concat(v.getMonth()+1):v.getMonth()+1,"-").concat(1===v.getDate().toString().length?"0".concat(v.getDate()):v.getDate()," 12:00:00.000"),x={nomor_tiket:n.nomor_tiket,mulai_keluhan:m,selesai_keluhan:p,problem:n.problem,action:n.action,status:"closed",keluhan_id:F.keluhan.id_keluhan,deskripsi:n.deskripsi,user_id:K.id_user},e.prev=6,e.next=9,I({id:a,body:x}).unwrap();case 9:"success"===(null===(f=e.sent)||void 0===f?void 0:f.status)||"Success"===(null===f||void 0===f?void 0:f.status)?((0,b.Z)(f),setTimeout((function(){V("/reason_of_outage",{replace:!0}),M((0,h.UT)({data:{}}))}),1e3)):(0,g.Z)(f,!0),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),(0,g.Z)(e.t0,!0);case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(a){return e.apply(this,arguments)}}(),V=(0,c.s0)();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(k.tW,{detailComplain:null===F||void 0===F?void 0:F.keluhan}),(0,j.jsxs)("div",{className:"flex w-full gap-5 mt-5 flex-col-reverse lg:flex-row",children:[(0,j.jsxs)("div",{className:"flex-1 w-full mt-5",children:[(0,j.jsx)("h1",{className:"text-center font-semibold",children:"Reason For Outage Keluhan"}),(0,j.jsx)(d.J9,{enableReinitialize:!0,validationSchema:f.sw,initialValues:z,onSubmit:function(e,a){var n=a.resetForm;U(e,n)},children:function(e){var a,n,t,l,s,i,r,o=e.values,c=e.errors,u=e.touched,v=e.isValid,m=e.handleChange,p=e.handleBlur;return(0,j.jsxs)(d.l0,{children:[(0,j.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,j.jsxs)("div",{className:"form-control",children:[(0,j.jsx)("label",{htmlFor:"problem",className:"label",children:(0,j.jsx)("span",{className:"label-text",children:" Masalah:"})}),(0,j.jsx)(d.gN,{id:"problem",name:"problem",placeholder:"Masalah",value:o.problem,component:"textarea",onBlur:p,onChange:m,disabled:!_,className:"textarea textarea-bordered h-24"}),c.problem&&u.problem&&(0,j.jsx)(k.aH,{errors:c.problem})]}),(0,j.jsxs)("div",{className:"form-control",children:[(0,j.jsx)("label",{htmlFor:"action",className:"label",children:(0,j.jsx)("span",{className:"label-text",children:" Aksi:"})}),(0,j.jsx)(d.gN,{id:"action",name:"action",placeholder:"Aksi",value:o.action,component:"textarea",onBlur:p,onChange:m,disabled:!_,className:"textarea textarea-bordered h-24"}),c.action&&u.action&&(0,j.jsx)(k.aH,{errors:c.action})]}),(0,j.jsxs)("div",{className:"form-control",children:[(0,j.jsx)("label",{htmlFor:"deskripsi",className:"label",children:(0,j.jsx)("span",{className:"label-text",children:" Deskripsi:"})}),(0,j.jsx)(d.gN,{id:"deskripsi",name:"deskripsi",placeholder:"Deskripsi",value:o.deskripsi,component:"textarea",onBlur:p,disabled:!_,onChange:m,className:"textarea textarea-bordered h-24"}),c.deskripsi&&u.deskripsi&&(0,j.jsx)(k.aH,{errors:c.deskripsi})]}),(0,j.jsxs)("div",{className:"flex flex-col lg:flex-row gap-5",children:[(0,j.jsxs)("div",{className:"form-control flex-1",children:[(0,j.jsx)("label",{htmlFor:"mulai_gangguan",className:"label",children:(0,j.jsx)("span",{className:"label-text",children:" Waktu Mulai Keluhan"})}),(0,j.jsx)(d.gN,{id:"mulai_gangguan",name:"mulai_gangguan",placeholder:"",value:new Date(null===F||void 0===F||null===(a=F.keluhan)||void 0===a?void 0:a.created_at).toLocaleString("id-ID"),type:"text",onBlur:p,onChange:m,disabled:!0,className:"input input-md input-bordered  max-w-full"}),c.mulai_gangguan&&u.mulai_gangguan&&(0,j.jsx)(k.aH,{errors:c.mulai_gangguan})]}),(0,j.jsxs)("div",{className:"form-control flex-1",children:[(0,j.jsx)("label",{htmlFor:"selesai_gangguan",className:"label",children:(0,j.jsx)("span",{className:"label-text",children:"Waktu Selesai Keluhan"})}),(0,j.jsx)(d.gN,{id:"selesai_gangguan",name:"selesai_gangguan",placeholder:"",value:(null===F||void 0===F||null===(n=F.keluhan)||void 0===n?void 0:n.balasan.length)>0?new Date(null===F||void 0===F||null===(t=F.keluhan)||void 0===t||null===(l=t.balasan[(null===F||void 0===F||null===(s=F.keluhan)||void 0===s||null===(i=s.balasan)||void 0===i?void 0:i.length)-1])||void 0===l?void 0:l.created_at).toLocaleString("id-ID"):new Date(null===F||void 0===F||null===(r=F.keluhan)||void 0===r?void 0:r.created_at).toLocaleString("id-ID"),type:"text",onBlur:p,onChange:m,disabled:!0,className:"input input-md input-bordered  max-w-full"}),c.selesai_gangguan&&u.selesai_gangguan&&(0,j.jsx)(k.aH,{errors:c.selesai_gangguan})]})]})]}),(0,j.jsx)("div",{className:"flex gap-3 mt-2",children:(0,j.jsxs)("div",{className:"form-control flex-1",children:[(0,j.jsx)("label",{htmlFor:"nomor_tiket",className:"label",children:(0,j.jsx)("span",{className:"label-text",children:"Tiket Pelaporan (Opsional)"})}),(0,j.jsx)(d.gN,{id:"nomor_tiket",name:"nomor_tiket",placeholder:"",value:o.nomor_tiket,type:"text",disabled:!_,onBlur:p,onChange:m,className:"input input-md input-bordered  max-w-full"})]})}),(0,j.jsxs)("div",{className:"modal-action justify-center mt-10",children:[(0,j.jsx)(k.zx,{type:"button",className:"mr-5",onClick:function(){return M((0,h.UT)({data:{}})),void V("/reason_of_outage")},children:"Kembali"}),_&&(0,j.jsx)(k.zx,{disabled:!v,type:"submit",className:"btn-success",children:"Simpan"})]})]})}})]}),(0,j.jsx)("div",{className:" border-gray-100 border-2"}),(0,j.jsxs)("div",{className:"flex-1 overflow-auto mt-6 w-full",style:{height:"50rem"},children:[(0,j.jsx)("h1",{className:"text-center font-semibold",children:"Riwayat Follow Up Keluhan"}),S&&(0,j.jsx)(m.default,{rfoSingle:!0,idComplain:null===F||void 0===F||null===(e=F.keluhan)||void 0===e?void 0:e.id_keluhan})]})]})]})}}}]);
//# sourceMappingURL=107.f1a0d730.chunk.js.map